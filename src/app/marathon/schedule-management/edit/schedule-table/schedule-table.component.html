<app-element-table>
  <app-element-table-row header>
    <app-element-table-cell [isHeader]="true">{{ 'marathon.submissions.table.runner' | translate}}</app-element-table-cell>
    <app-element-table-cell [isHeader]="true">{{ 'marathon.submissions.table.game' | translate}}</app-element-table-cell>
    <app-element-table-cell [isHeader]="true">{{ 'marathon.submissions.table.category' | translate}}</app-element-table-cell>
    <app-element-table-cell [isHeader]="true">{{ 'marathon.submissions.table.console' | translate}}</app-element-table-cell>
    <app-element-table-cell [isHeader]="true">{{ 'marathon.submissions.table.estimate' | translate}}</app-element-table-cell>
    <app-element-table-cell [isHeader]="true">{{ 'marathon.submissions.table.actions' | translate}}</app-element-table-cell>
  </app-element-table-row>

  <ng-template ngFor [ngForOf]="lines" let-line let-i="index">
    <app-element-table-row [class]="getRowParity(i)">
      <app-element-table-cell [isExpandButton]="true"
                              [expanded]="expanded.has(line.id)"
                              class="expandable"
                              (click)="toggleExpand(line.id)"
      ></app-element-table-cell>

      <ng-template [ngIf]="line.setupBlock" [ngIfElse]="notASetupBlock">
        <app-element-table-cell>
          <strong>{{'marathon.schedule.setupBlock' | translate}}</strong>
        </app-element-table-cell>
        <app-element-table-cell>
          {{ line.setupBlockText ?? 'Default Setup Block text' }}
        </app-element-table-cell>
        <app-element-table-cell>
          {{ line.setupTime }}
        </app-element-table-cell>
      </ng-template>

      <ng-template #notASetupBlock>
        <app-element-table-cell>
        <span *ngFor="let runner of line.runners">
          {{ runner.runnerName ?? runner.profile.displayName }}
        </span>
        </app-element-table-cell>
        <app-element-table-cell>
          <app-simple-md [data]="line.game" ></app-simple-md>
        </app-element-table-cell>
        <app-element-table-cell>
          <app-simple-md [data]="line.category" ></app-simple-md>
        </app-element-table-cell>
        <app-element-table-cell>{{ line.console }}</app-element-table-cell>
        <app-element-table-cell>{{ line.estimate }}</app-element-table-cell>
      </ng-template>


      <app-element-table-cell>
        <a (click)="moveToToDo.emit(i)" *ngIf="!line.customRun">
          <fa-icon [icon]="iconChevronLeft"></fa-icon>
        </a>
        <a (click)="delete.emit(i)" *ngIf="line.customRun">
          <fa-icon [icon]="iconTimes"></fa-icon>
        </a>
        <a (click)="toggleExpand(line.id)">
          <fa-icon [icon]="iconEdit"></fa-icon>
        </a>
        <fa-icon [icon]="iconBars" cdkDragHandle class="is-pulled-right"></fa-icon>
      </app-element-table-cell>
    </app-element-table-row>

    <app-element-table-detail *ngIf="expanded.has(line.id)" [class]="getRowParity(i)">
      <!-- TODO: turn this into a component -->
      <!-- TODO: Insert translations -->
      <!-- TODO: add styling -->
      <!-- TODO: different controls (separate component) for setup block settings -->
      <div>
        <label for="game-{{i}}">{{ 'marathon.schedule.table.game' | translate}}:</label>
        <input type="text" name="game-{{i}}" id="game-{{i}}" [(ngModel)]="line.game"/>
      </div>

      <div>
        <label for="type-{{i}}">{{ 'marathon.schedule.table.type' | translate}}:</label>
        <span
          *ngIf="line.runners.length === 1 && !line.customRun">{{'marathon.schedule.type.SINGLE' | translate}}</span>
        <div class="select" *ngIf="line.runners.length > 1 || line.customRun">
          <select [(ngModel)]="line.type" id="type-{{i}}" name="type-{{i}}">
            <option value="SINGLE"
                    *ngIf="line.customRun">{{ 'marathon.schedule.type.SINGLE' | translate}}</option>
            <option value="RACE">{{ 'marathon.schedule.type.RACE' | translate}}</option>
            <option value="COOP">{{ 'marathon.schedule.type.COOP' | translate}}</option>
            <option value="COOP_RACE">{{ 'marathon.schedule.type.COOP_RACE' | translate}}</option>
            <option value="RELAY">{{ 'marathon.schedule.type.RELAY' | translate}}</option>
            <option value="RELAY_RACE">{{ 'marathon.schedule.type.RELAY_RACE' | translate}}</option>
            <option value="OTHER">{{ 'marathon.schedule.type.OTHER' | translate}}</option>
          </select>
        </div>
      </div>


      <!-- (custom data exists for both setup block and normal runs) -->
      <div>
        <label for="custom-data-{{i}}">
          {{ 'marathon.schedule.management.customData.inputText' | translate }}
        </label>

        <textarea id="custom-data-{{i}}" class="textarea"
                  [(ngModel)]="line.customData"
                  placeholder='{"layout": "19:9", "other-data": "here"} or whatever else you want'></textarea>
      </div>input also lives here
    </app-element-table-detail>
  </ng-template>
</app-element-table>
